<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –£–º–Ω–æ–≥–æ –î–æ–º–∞</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üè† –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –£–º–Ω–æ–≥–æ –î–æ–º–∞</h1>
            <div class="status-bar">
                <div id="rtu-status" class="status-item">RTU: <span class="badge offline">–û—Ç–∫–ª—é—á–µ–Ω–æ</span></div>
                <div id="tcp-status" class="status-item">TCP: <span class="badge offline">–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</span></div>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-button active" onclick="switchTab('network')">–°–µ—Ç—å</button>
            <button class="tab-button" onclick="switchTab('modbus-rtu')">Modbus RTU</button>
            <button class="tab-button" onclick="switchTab('modbus-tcp')">Modbus TCP</button>
            <button class="tab-button" onclick="switchTab('config')">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</button>
        </nav>

        <!-- –í–∫–ª–∞–¥–∫–∞ –°–µ—Ç—å -->
        <section id="network" class="tab-content active">
            <h2>–°–µ—Ç–µ–≤—ã–µ –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            
            <div class="form-group">
                <label>–ò–º—è —Ö–æ—Å—Ç–∞:</label>
                <div class="input-group">
                    <input type="text" id="hostname-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ö–æ—Å—Ç–∞">
                    <button onclick="setHostname()" class="btn btn-primary">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>

            <div class="info-panel">
                <h3>–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h3>
                <div id="network-info"></div>
            </div>

            <button onclick="refreshNetworkConfig()" class="btn btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </section>

        <!-- –í–∫–ª–∞–¥–∫–∞ Modbus RTU -->
        <section id="modbus-rtu" class="tab-content">
            <h2>Modbus RTU</h2>
            
            <div class="control-panel">
                <div class="form-group">
                    <label>–ü–æ—Ä—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä /dev/ttyUSB0):</label>
                    <input type="text" id="rtu-port" value="/dev/ttyUSB0" placeholder="/dev/ttyUSB0">
                </div>

                <div class="form-group">
                    <label>–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏ (–±–æ–¥):</label>
                    <select id="rtu-baudrate">
                        <option value="9600">9600</option>
                        <option value="19200">19200</option>
                        <option value="38400">38400</option>
                        <option value="57600">57600</option>
                        <option value="115200">115200</option>
                    </select>
                </div>

                <div class="button-group">
                    <button onclick="connectRTU()" class="btn btn-success">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
                    <button onclick="disconnectRTU()" class="btn btn-danger">–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
                </div>
            </div>

            <div class="info-panel">
                <h3>–ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="form-group">
                    <label>ID Slave:</label>
                    <input type="number" id="rtu-read-slave" value="1" min="1" max="247">
                </div>

                <div class="form-group">
                    <label>–¢–∏–ø —á—Ç–µ–Ω–∏—è:</label>
                    <select id="rtu-read-type">
                        <option value="coils">–ö–∞—Ç—É—à–∫–∏ (Coils)</option>
                        <option value="discrete_inputs">–î–∏—Å–∫—Ä–µ—Ç–Ω—ã–µ –≤—Ö–æ–¥—ã</option>
                        <option value="holding_registers">–†–µ–≥–∏—Å—Ç—Ä—ã —É–¥–µ—Ä–∂–∞–Ω–∏—è</option>
                        <option value="input_registers">–í—Ö–æ–¥–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–ù–∞—á–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å:</label>
                    <input type="number" id="rtu-read-start" value="0" min="0">
                </div>

                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                    <input type="number" id="rtu-read-qty" value="10" min="1">
                </div>

                <button onclick="readRTU()" class="btn btn-primary">–ü—Ä–æ—á–∏—Ç–∞—Ç—å</button>
                <div id="rtu-read-result" class="result-panel"></div>
            </div>

            <div class="info-panel">
                <h3>–ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="form-group">
                    <label>ID Slave:</label>
                    <input type="number" id="rtu-write-slave" value="1" min="1" max="247">
                </div>

                <div class="form-group">
                    <label>–¢–∏–ø –∑–∞–ø–∏—Å–∏:</label>
                    <select id="rtu-write-type">
                        <option value="coil">–û–¥–Ω–∞ –∫–∞—Ç—É—à–∫–∞</option>
                        <option value="register">–û–¥–∏–Ω —Ä–µ–≥–∏—Å—Ç—Ä</option>
                        <option value="coils">–ù–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ç—É—à–µ–∫</option>
                        <option value="registers">–ù–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–ê–¥—Ä–µ—Å:</label>
                    <input type="number" id="rtu-write-addr" value="0" min="0">
                </div>

                <div class="form-group">
                    <label>–ó–Ω–∞—á–µ–Ω–∏–µ (JSON –¥–ª—è –º–∞—Å—Å–∏–≤–∞):</label>
                    <input type="text" id="rtu-write-value" value="1" placeholder="1 –∏–ª–∏ [1, 0, 1]">
                </div>

                <button onclick="writeRTU()" class="btn btn-primary">–ó–∞–ø–∏—Å–∞—Ç—å</button>
                <div id="rtu-write-result" class="result-panel"></div>
            </div>
        </section>

        <!-- –í–∫–ª–∞–¥–∫–∞ Modbus TCP -->
        <section id="modbus-tcp" class="tab-content">
            <h2>Modbus TCP –°–µ—Ä–≤–µ—Ä</h2>
            
            <div class="control-panel">
                <div class="form-group">
                    <label>IP –∞–¥—Ä–µ—Å (0.0.0.0 –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤):</label>
                    <input type="text" id="tcp-host" value="0.0.0.0" placeholder="0.0.0.0">
                </div>

                <div class="form-group">
                    <label>–ü–æ—Ä—Ç:</label>
                    <input type="number" id="tcp-port" value="5020" min="1024" max="65535">
                </div>

                <div class="button-group">
                    <button onclick="startTCPServer()" class="btn btn-success">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                    <button onclick="stopTCPServer()" class="btn btn-danger">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>

            <div class="info-panel">
                <h3>–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞</h3>
                <div id="tcp-status-info"></div>
                <button onclick="refreshTCPStatus()" class="btn btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
        </section>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è -->
        <section id="config" class="tab-content">
            <h2>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h2>
            
            <button onclick="saveConfig()" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
            <button onclick="loadConfig()" class="btn btn-secondary">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
            
            <textarea id="config-editor" class="config-editor"></textarea>
        </section>
    </div>

    <footer>
        <p>–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –£–º–Ω–æ–≥–æ –î–æ–º–∞ v1.0 | Ubuntu</p>
    </footer>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
