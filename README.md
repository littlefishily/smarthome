# –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –£–º–Ω–æ–≥–æ –î–æ–º–∞ - Smart Home Controller

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ—à–∏–≤–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —É–º–Ω–æ–≥–æ –¥–æ–º–∞ –Ω–∞ Python –¥–ª—è Ubuntu —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Modbus RTU/TCP –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **Modbus RTU –ú–∞—Å—Ç–µ—Ä**: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RTU —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —á–µ—Ä–µ–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä—Ç
- **Modbus TCP –°–µ—Ä–≤–µ—Ä**: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ RTU —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º —á–µ—Ä–µ–∑ TCP
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –ö—Ä–∞—Å–∏–≤—ã–π –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **–°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ IP –∞–¥—Ä–µ—Å–æ–º, –∏–º–µ–º —Ö–æ—Å—Ç–∞, DHCP/Static
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: JSON-based –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ —Ñ–∞–π–ª
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
smarthome/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py              # –ì–ª–∞–≤–Ω–æ–µ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ config_manager.py         # –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ network_manager.py        # –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Ç–µ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îÇ   ‚îú‚îÄ‚îÄ modbus/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rtu_master.py        # Modbus RTU –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tcp_server.py        # Modbus TCP —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ web/
‚îÇ       ‚îú‚îÄ‚îÄ templates/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.html       # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ       ‚îî‚îÄ‚îÄ static/
‚îÇ           ‚îú‚îÄ‚îÄ style.css        # –°—Ç–∏–ª–∏
‚îÇ           ‚îî‚îÄ‚îÄ script.js        # JavaScript
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.json              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ systemd/
‚îÇ   ‚îî‚îÄ‚îÄ smarthome.service        # Systemd —Å–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ main.py                      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ run.sh                       # –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ install.sh                   # –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îú‚îÄ‚îÄ requirements.txt             # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md                    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Ubuntu 20.04 –∏–ª–∏ –Ω–æ–≤–µ–µ
- Python 3.8+
- pip
- Git (–¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
sudo chmod +x install.sh
sudo ./install.sh
```

### –°–ø–æ—Å–æ–± 2: –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo mkdir -p /opt/smarthome
cd /opt/smarthome

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
sudo apt-get update
sudo apt-get install -y python3 python3-pip python3-venv

# 3. –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv
source venv/bin/activate

# 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python –ø–∞–∫–µ—Ç—ã
pip install -r requirements.txt

# 5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å systemd —Å–µ—Ä–≤–∏—Å
sudo cp systemd/smarthome.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable smarthome.service
```

## –ó–∞–ø—É—Å–∫

### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
chmod +x run.sh
./run.sh
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8000`

### –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º

```bash
sudo systemctl start smarthome
sudo systemctl status smarthome
sudo journalctl -u smarthome -f  # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: `/etc/smarthome/config.json`

```json
{
  "network": {
    "hostname": "smarthome-controller",
    "ip_mode": "dhcp",
    "ip_address": "192.168.1.100",
    "netmask": "255.255.255.0",
    "gateway": "192.168.1.1"
  },
  "modbus_tcp": {
    "enabled": true,
    "host": "0.0.0.0",
    "port": 5020
  },
  "modbus_rtu": {
    "enabled": true,
    "port": "/dev/ttyUSB0",
    "baudrate": 9600,
    "timeout": 1
  }
}
```

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://<IP-–∞–¥—Ä–µ—Å>:8000`

–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏:
1. **–°–µ—Ç—å** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç–µ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
2. **Modbus RTU** - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RTU —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
3. **Modbus TCP** - –ó–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ TCP —Å–µ—Ä–≤–µ—Ä–∞
4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## API Endpoints

### System
- `GET /api/system/status` - –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã

### Network
- `GET /api/network/config` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ç–∏
- `GET /api/network/hostname` - –ü–æ–ª—É—á–∏—Ç—å –∏–º—è —Ö–æ—Å—Ç–∞
- `POST /api/network/hostname` - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–º—è —Ö–æ—Å—Ç–∞

### Configuration
- `GET /api/config/get` - –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- `POST /api/config/update` - –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### Modbus RTU
- `GET /api/modbus/rtu/status` - –°—Ç–∞—Ç—É—Å RTU
- `POST /api/modbus/rtu/connect` - –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
- `POST /api/modbus/rtu/disconnect` - –û—Ç–∫–ª—é—á–∏—Ç—å—Å—è
- `POST /api/modbus/rtu/read` - –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `POST /api/modbus/rtu/write` - –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö

### Modbus TCP
- `GET /api/modbus/tcp/status` - –°—Ç–∞—Ç—É—Å TCP —Å–µ—Ä–≤–µ—Ä–∞
- `POST /api/modbus/tcp/start` - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
- `POST /api/modbus/tcp/stop` - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ß—Ç–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ RTU

```bash
curl -X POST http://localhost:8000/api/modbus/rtu/read \
  -H "Content-Type: application/json" \
  -d '{
    "slave_id": 1,
    "type": "holding_registers",
    "start_addr": 0,
    "quantity": 10
  }'
```

### –ó–∞–ø–∏—Å—å —Ä–µ–≥–∏—Å—Ç—Ä–∞ RTU

```bash
curl -X POST http://localhost:8000/api/modbus/rtu/write \
  -H "Content-Type: application/json" \
  -d '{
    "slave_id": 1,
    "type": "register",
    "addr": 0,
    "value": 100
  }'
```

### –ó–∞–ø—É—Å–∫ TCP —Å–µ—Ä–≤–µ—Ä–∞

```bash
curl -X POST http://localhost:8000/api/modbus/tcp/start \
  -H "Content-Type: application/json" \
  -d '{
    "host": "0.0.0.0",
    "port": 5020
  }'
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º

```bash
# –ó–∞–ø—É—Å–∫
sudo systemctl start smarthome

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo systemctl stop smarthome

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
sudo systemctl restart smarthome

# –°—Ç–∞—Ç—É—Å
sudo systemctl status smarthome

# –õ–æ–≥–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫)
sudo journalctl -u smarthome -n 100

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u smarthome -f

# –í–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
sudo systemctl enable smarthome

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
sudo systemctl disable smarthome
```

## –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### RTU –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ: `ls -la /dev/ttyUSB*`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: `sudo usermod -a -G dialout smarthome`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ—Ä—Ç–∞ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏

### TCP –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç
- –ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5020)
- –ò–ª–∏ –Ω–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å: `sudo lsof -i :5020`

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã: `ip link show`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ IP –∞–¥—Ä–µ—Å–∞: `ip addr show`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç—ã: `ip route show`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. –ü–æ—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º reverse proxy (nginx)
2. –î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ HTTPS
3. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø —Ñ–∞–π—Ä–≤–æ–ª–æ–º
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VPN –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏: `sudo journalctl -u smarthome -f`
2. –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞: `sudo systemctl status smarthome`
3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: `sudo cat /etc/smarthome/config.json`

## Roadmap

- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- [ ] HTTPS –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] REST API –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- [ ] MQTT –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] Docker –æ–±—Ä–∞–∑

---

–°–æ–∑–¥–∞–Ω–æ –¥–ª—è —É–º–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –≤ –¥–æ–º–µ üè†
